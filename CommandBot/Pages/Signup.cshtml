@page
@model CommandBot.Pages.SignupModel
@{
    Layout = null;
}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Sign Up - ShakeApp</title>
  <link rel="stylesheet" href="~/css/bootstrap/bootstrap.min.css">
  <style>
    /* Visual refresh inspired by the template builder: cleaner inputs, rounded panels and WhatsApp-accented actions */
    *{box-sizing:border-box;margin:0;padding:0}
    :root{
      --brand:#c41e3a;
      --whatsapp:#25D366;
      --muted:#666;
      --panel-bg:#ffffff;
      --page-bg:#f3f6f9;
      --shadow:0 10px 30px rgba(18,24,33,0.06);
      --radius:12px;
    }

    html,body{height:100%}
    body{
      font-family:-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(180deg, #f7f9fb 0%, var(--page-bg) 100%);
      padding:28px;
      color:#222;
      display:flex;
      justify-content:center;
    }

    .container{max-width:760px;width:100%}

    h1{color:var(--brand);text-align:center;margin-bottom:6px}
    .lead{color:var(--muted);text-align:center;margin-bottom:14px}

    .form-card{
      background:var(--panel-bg);
      padding:22px;
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      border:1px solid rgba(16,24,32,0.03);
    }

    label{display:block;font-weight:700;color:#333;margin-bottom:6px;font-size:14px}

    input[type="text"], input[type="email"], input[type="tel"], textarea{
      width:100%;
      padding:12px 14px;
      border-radius:10px;
      border:1px solid #e6e9ee;
      background:#fff;
      font-size:14px;
      transition:box-shadow .15s, border-color .15s, transform .05s;
      outline:none;
    }

    input:focus, textarea:focus{
      border-color:var(--whatsapp);
      box-shadow:0 6px 20px rgba(37,211,102,0.08);
    }

    textarea{min-height:92px;resize:vertical}

    .mb-3{margin-bottom:14px}

    .btn-whatsapp{
      display:inline-block;
      width:100%;
      text-align:center;
      background:var(--whatsapp);
      color:#fff;
      border:none;
      padding:12px 16px;
      border-radius:10px;
      font-weight:700;
      box-shadow:0 8px 20px rgba(37,211,102,0.12);
      cursor:pointer;
      transition:transform .08s, box-shadow .12s, filter .08s;
    }

    .btn-whatsapp:hover{transform:translateY(-2px);filter:brightness(.98);box-shadow:0 12px 30px rgba(37,211,102,0.14)}

    .small-note{font-size:13px;color:var(--muted);margin-top:12px}

    @@media(max-width:520px){
      body{padding:16px}
      .form-card{padding:16px}
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Sign Up</h1>
    <p class="lead">Submit your details and open WhatsApp to send the signup form to us.</p>
    <div class="form-card">
    <form id="signupForm">
      <div class="mb-3">
        <label class="form-label">Name</label>
        <input type="text" name="name" class="form-control" required>
      </div>
      <div class="mb-3">
        <label class="form-label">Email</label>
        <input type="email" name="email" class="form-control" required>
      </div>
      <div class="mb-3">
        <label class="form-label">Physical Address</label>
        <input type="text" name="address" class="form-control" required>
      </div>
      <div class="mb-3">
        <label class="form-label">Emergency contact name</label>
        <input type="text" name="ecName" class="form-control" required>
      </div>
      <div class="mb-3">
        <label class="form-label">Emergency contact number</label>
        <input type="tel" name="ecNumber" class="form-control" required>
      </div>
      <div class="mb-3">
        <label class="form-label">Reason for prescription</label>
        <textarea name="reason" class="form-control" rows="3" required></textarea>
      </div>

      <button type="submit" class="btn-whatsapp">ðŸ“± Submit via WhatsApp</button>
    </form>
    </div>
    <p class="mt-3 small-note">This will open WhatsApp with the message pre-filled and target the number +27 77 202 2523.</p>
  </div>

  <script>
    const form = document.getElementById('signupForm');
    const urlParams = new URLSearchParams(window.location.search);
    const firstSignedUpWith = urlParams.get('FirstSignedUpWith')?.trim();
    const note = document.querySelector('.small-note');
    const defaultNote = 'This will open WhatsApp with the message pre-filled and target the number +27 77 202 2523.';

    if (note) {
      note.textContent = firstSignedUpWith
        ? `${defaultNote} Signing up through "${firstSignedUpWith}".`
        : defaultNote;
    }

    if (form) {
      form.addEventListener('submit', function (e) {
        e.preventDefault();
        const name = (form.querySelector('[name="name"]')).value.trim();
        const email = (form.querySelector('[name="email"]')).value.trim();
        const address = (form.querySelector('[name="address"]')).value.trim();
        const ecName = (form.querySelector('[name="ecName"]')).value.trim();
        const ecNumber = (form.querySelector('[name="ecNumber"]')).value.trim();
        const reason = (form.querySelector('[name="reason"]')).value.trim();

        const signupData = {
          Name: name,
          Email: email,
          Address: address,
          EmergencyContactName: ecName,
          EmergencyContactNumber: ecNumber,
          Reason: reason
        };

        if (firstSignedUpWith) {
          signupData.FirstSignedUpWith = firstSignedUpWith;
        }

        const jsonPayload = JSON.stringify(signupData);
        const payload = `#webform usersignup: ${jsonPayload}`;

        const encoded = encodeURIComponent(payload);
        // Open WhatsApp and target the specific number (international format without + or spaces)
        const phone = '27772022523'; // +27 77 202 2523
        const url = `https://wa.me/${phone}?text=${encoded}`;
        window.open(url, '_blank');
      });
    }
  </script>
</body>
</html>
